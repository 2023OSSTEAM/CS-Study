### 3.2.1 메모리 계층

![](attachments/Pasted%20image%2020230216233311.png)

#### 캐시

데이터를 미리 복사해두는 임시 저장소, 병목 현상을 줄이기 위함.

##### 지역성의 원리

로컬리티 locality

###### 시간 지역성

최근 사용한 데이터에 다시 접근하려는 특성을 말합니다.

###### 공간 지역성

최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성을 말합니다.

#### 캐시히트와 캐시미스

![](attachments/Pasted%20image%2020230216233547.png)
캐시미스가 발생하면 메모리에 직접 접근해서 데이터를 가져와야 하는데, 시스템 버스를 기반으로 하기 때문에 캐시에 비해 느리다.

##### 캐시매핑

!!! 매우 중요

###### 직접 매핑

Directed mapping

메모리가 1-100까지, 캐시가 1-10까지 있다면, 즉 캐시가 메모리의 10분의 1이라면, 메모리를 10조각으로 잘게 나눠서 할당하는 것을 뜻함.

즉 1-10 사이의 메모리 접근은 1번째 캐시에 저장해둔다.

단점: 지역적 로컬리티를 전혀 고려하지 않고, 캐시 미스가 잦다. 

###### 연관 매핑

Associative mapping

순서 없이 관련 있는 캐시와 메모리를 매핑합니다. 충돌이 적지만 모든 캐시 블록을 탐색해야 해서 속도가 느립니다.

Q. 연관매핑의 예시 #question 

###### 집합 연관 매핑

Set associative mapping

직접 매핑과 연관 매핑을 합쳐 놓은 것이다. 순서는 일치시키지만 집합을 둬서 저장한다. 검색은 조금 더 효율적이다. 

Q. 책 예시가 부실. 집합 연관 매핑의 예시 #question 

##### 웹 브라우저의 캐시

###### 쿠키

만료기한이 있는 키-값 저장소. 4KB까지 정할 수 있습니다.
httponly 옵션이 중요하다. 주로 서버에서 만료기한을 정한다.

###### 로컬 스토리지

만료기한이 없는 키-값 저장소. 10MB까지 저장할 수 있으며 웹 브라우저를 닫아도 유지된다. HMTL5가 지원되어야만 사용할 수 있다.

Q. 도메인 단위로 저장된다는 게 무슨 의미인가? #question 

###### 세션 스토리지

만료기한이 없는 키-값 저장소. 탭 단위로 세션 스토리지를 생성하며, 탭을 닫을 때 해당 데이터가 삭제됩니다. 5MB까지 지원 가능. HTML5에서만 가능.

##### 디비의 캐싱 계층

레디스 등의 주메모리 기반 캐싱 계층을 둬서 디비 성능을 향상시킵니다.

---

### 3.2.2 메모리 관리

#### 가상 메모리

메모리 관리 기법의 하나로 컴퓨터가 실제로 이용 가능한 메모리 자원을 추상화하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것

##### TLB

메모리와 CPU 사이에 있는 주소 변환을 위한 캐시. 페이지 테이블에 있는 리스트를 보관하며 CPU가 페이지 테이블까지 가지 않도록 해 속도를 향상시킬 수 있다.

#### 스와핑

생략

#### 페이지 폴트

page fault

프로세스 주소 공간에는 존재하지만 지금 이 컴퓨터의 RAM에는 없는 데이터에 접근했을 때 발생한다.

1. 물리 메모리를 확인하여 없으면 트랩을 발생시킨다.
2. CPU 정지
3. 페이지 테이블을 확인하여 가상 메모리에 페이지가 존재하는지 확인하고, 없으면 프로세스를 중단하고 현재 물리 메모리에 비어 있는 프레임이 있는지 찾습니다.
4. 비어 있는 프레임에 해당 페이지를 로드하고, 페이지 테이블을 최신화합니다.
5. CPU  재시작

##### 페이지

가상 메모리 최소 단위

##### 프레임

물리 메모리 최소 단위

#### 스레싱

thrashing

메모리의 페이지 폴트율이 높은 것을 의미하며, 심각한 성능 저하를 초래한다.

메모리에 너무 많은 프로세스가 동시에 올라가면, 스와핑이 많이 발생한다. 그러면 CPU 이용률이 낮아지고, 이용률이 낮아지면 더 많은 프로세스가 메모리에 올라가는 악순환이 벌어진다. 

해결책:

##### 작업 세트

working set

로컬리티를 이용해서 비슷한 페이지 집합들을 미리 로딩해두는 것이다.

##### PFF

Page Fault Frequency

페이지 폴트 빈도를 조절하는 방법. 상한과 하한을 만든다. 상한에 도달하면 프레임을 늘리고, 하한에 도달하면 프레임을 줄인다.

Q. 하한에 도달하면 프레임을 줄인다는 게 무슨 의미인가? #question 

#### 메모리 할당

##### 연속 할당

연속적으로 공간을 할당하는 것

###### 고정 분할 방식

fixed partition allocation

메모리를 미리 나누어 관리하는 방식. 내부 단편화가 발생한다.

###### 가변 분할 방식

variable partition allocation

프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용합니다. 외부 단편화가 발생합니다.

- first fit: 위에서부터 홀을 찾으면 바로 할당한다.
- best fit: 맞는 메모리 공간 중 가장 작은 공간을 찾는다.
- worst fit: 크기가 가장 많이 차이나는 홀에 할당한다.

등의 방법이 있다.

##### 내부 단편화

메모리를 나눈 크기보다 프로그램이 작아서 들어가지 못하는 공간이 많이 발생하는 상황

##### 외부 단편화

메모리를 나눈 크기보다 프로그램이 커서 들어가지 못하는 공간이 많이 발생하는 현상

Q. 좀 더 자세히 설명해보아라. #question 

---

##### 불연속 할당

메모리를 동일한 크기의 페이지 (4kb)로 나누고 페이지 테이블을 두어 이를 통해 메모리에 프로그램을 할당하는 방식.

###### 페이징

동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스를 할당합니다. 주소 변환이 복잡하다.

###### 세그멘테이션

segmentation

???

###### 페이지드 세그멘테이션

???

#### 페이지 교체 알고리즘

offline algorithm: 미래를 알고 있는 방법

##### FIFO

가장 먼저 온 페이지를 교체해버리는 것

##### LRU

가장 오래된 페이지를 교체

계수기와 스택을 두어야 한다. 

두 개의 자료 구조로 구현한다.

해시 테이블을 통해 빨리 찾을 수 있도록 하고,

이중 연결 리스트에서 뺀다.

##### NUR

Not Used Recently

시계 방향으로 돌면서 1이면 0으로 바꾸고, 0이면 바꾸는 알고리즘입니다.

굉장히 간단하고 빠르고 쉽다.

### LFU

Least Frequently Used

가장 참조 횟수가 적은 페이지를 교체한다.

단점: 한번에 엄청 많이 쓰이고 더 이상 쓰이지 않는 페이지는 계속 남아있는다.

Frecency가 중요할듯?


